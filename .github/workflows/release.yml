name: Auto Release

on:
  push:
    tags:
      - 'v*'  # å½“æ¨é€ä»¥vå¼€å¤´çš„tagæ—¶è§¦å‘

permissions:
  contents: write  # å…è®¸å†™å…¥å†…å®¹ï¼ˆåˆ›å»ºReleaseï¼‰
  packages: write  # å…è®¸å†™å…¥åŒ…

jobs:
  release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Build project
      run: npm run build
      
    - name: Build Chrome extension
      run: |
        chmod +x scripts/build-chrome.sh
        ./scripts/build-chrome.sh
        
    - name: Build Firefox extension
      run: |
        chmod +x scripts/build-firefox.sh
        ./scripts/build-firefox.sh
        
    - name: Build Edge extension
      run: |
        chmod +x scripts/build-edge.sh
        ./scripts/build-edge.sh
        
    - name: Get version from tag
      id: get_version
      run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
      
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.ref_name }}
        name: HackDuck ${{ github.ref_name }} - HTTP Request Debugger
        body: |
                 # HackDuck ${{ github.ref_name }} - HTTP Request Debugger
                 
                 ## ğŸ‰ è‡ªåŠ¨å‘å¸ƒ
                 
                 æ­¤ç‰ˆæœ¬é€šè¿‡GitHub Actionsè‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒã€‚
                 
                 ## âœ¨ ä¸»è¦åŠŸèƒ½
                 
                 - ğŸ” **å®æ—¶è¯·æ±‚æ‹¦æˆª**ï¼šæ•è·æµè§ˆå™¨å‘å‡ºçš„æ‰€æœ‰HTTPè¯·æ±‚
                 - ğŸ› ï¸ **åŒæ¨¡å¼ç•Œé¢**ï¼šBurp Suiteæ¨¡å¼å’ŒHackBaræ¨¡å¼
                 - ğŸ¯ **é«˜çº§åŠŸèƒ½**ï¼šå³é”®ç¼–ç èœå•ã€æ’¤é”€/é‡åšã€åŠ¨æ€é«˜åº¦è°ƒæ•´
                 - ğŸŒ **å¤šæµè§ˆå™¨æ”¯æŒ**ï¼šChromeã€Firefoxã€Edge
                 
                 ## ğŸ“¦ å®‰è£…è¯´æ˜
                 
                 1. ä¸‹è½½å¯¹åº”æµè§ˆå™¨çš„ZIPæ–‡ä»¶
                 2. è§£å‹åˆ°æœ¬åœ°ç›®å½•
                 3. æ‰“å¼€æµè§ˆå™¨æ‰©å±•ç®¡ç†é¡µé¢
                 4. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
                 5. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
                 6. é€‰æ‹©è§£å‹åçš„æ–‡ä»¶å¤¹
                 
                 ## ğŸ“‹ æ–‡ä»¶æ¸…å•
                 
                 - `hackduck-chrome-${{ github.ref_name }}.zip` - Chromeç‰ˆæœ¬
                 - `hackduck-firefox-${{ github.ref_name }}.zip` - Firefoxç‰ˆæœ¬
                 - `hackduck-edge-${{ github.ref_name }}.zip` - Edgeç‰ˆæœ¬
                 
                 ## ğŸ“ æ”¯æŒ
                 
                 å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡GitHub Issuesè”ç³»æˆ‘ä»¬ã€‚
                 
                 ---
                 
                 **HackDuck Team** - è®©HTTPè°ƒè¯•æ›´ç®€å•ï¼
        files: |
          releases/hackduck-chrome-*.zip
          releases/hackduck-firefox-*.zip
          releases/hackduck-edge-*.zip
          releases/updates.json
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
