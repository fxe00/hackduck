{"version":3,"file":"background.js","mappings":"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","sources":["webpack://hackduck/./src/background.ts"],"sourcesContent":["// ç«‹å³è¾“å‡ºæµ‹è¯•æ—¥å¿—\nconsole.log('ğŸš€ Background script starting...');\n// å­˜å‚¨æ‹¦æˆªçš„è¯·æ±‚\nlet interceptedRequests = [];\nlet isIntercepting = true; // é»˜è®¤å¼€å¯æ‹¦æˆª\n// æå–è¯·æ±‚ä½“å†…å®¹\nfunction extractRequestBody(requestBody) {\n    if (!requestBody)\n        return undefined;\n    try {\n        // å¤„ç†è¡¨å•æ•°æ®\n        if (requestBody.formData) {\n            const formData = requestBody.formData;\n            const params = new URLSearchParams();\n            for (const [key, values] of Object.entries(formData)) {\n                if (Array.isArray(values)) {\n                    values.forEach(value => params.append(key, value));\n                }\n                else {\n                    params.append(key, values);\n                }\n            }\n            return params.toString();\n        }\n        // å¤„ç†åŸå§‹æ•°æ®\n        if (requestBody.raw && requestBody.raw.length > 0) {\n            const rawData = requestBody.raw[0];\n            if (rawData.bytes) {\n                // å°è¯•è§£ç ä¸ºæ–‡æœ¬\n                const decoder = new TextDecoder('utf-8');\n                return decoder.decode(rawData.bytes);\n            }\n        }\n        return undefined;\n    }\n    catch (error) {\n        console.warn('Failed to extract request body:', error);\n        return undefined;\n    }\n}\n// å»é‡å‡½æ•°ï¼šç§»é™¤é‡å¤è¯·æ±‚ï¼Œä¿ç•™æœ€æ–°çš„\nfunction removeDuplicates(newRequest) {\n    // æŸ¥æ‰¾æ˜¯å¦æœ‰ç›¸åŒçš„URLå’Œæ–¹æ³•çš„è¯·æ±‚\n    const existingIndex = interceptedRequests.findIndex(req => req.url === newRequest.url && req.method === newRequest.method);\n    if (existingIndex !== -1) {\n        // ç§»é™¤æ—§çš„è¯·æ±‚\n        const removedRequest = interceptedRequests.splice(existingIndex, 1)[0];\n        console.log('ğŸ”„ Removed duplicate request:', {\n            url: newRequest.url,\n            method: newRequest.method,\n            oldIndex: existingIndex,\n            removedId: removedRequest.id,\n            newId: newRequest.id\n        });\n    }\n    // æ·»åŠ æ–°è¯·æ±‚åˆ°åˆ—è¡¨é¡¶éƒ¨\n    interceptedRequests.unshift(newRequest);\n    console.log('âœ… Added new request to list:', {\n        url: newRequest.url,\n        method: newRequest.method,\n        totalRequests: interceptedRequests.length\n    });\n}\n// è¶…æ—¶å¤„ç†æœºåˆ¶\nconst PENDING_TIMEOUT = 30000; // 30ç§’è¶…æ—¶\nconst pendingTimeouts = new Map();\n// HackBarè¯·æ±‚å¤„ç†å‡½æ•°\nasync function handleHackBarRequest(data) {\n    const { url, method, headers, body } = data;\n    console.log('ğŸš€ HackBar request received:', { url, method, headers, body });\n    // ç®€å•åœºæ™¯ï¼šGET ä¸”æ— è‡ªå®šä¹‰å¤´ â†’ ç›´æ¥è·³è½¬\n    const hasCustomHeader = Object.keys(headers).some(k => k.toLowerCase() !== 'user-agent' &&\n        k.toLowerCase() !== 'accept' &&\n        k.toLowerCase() !== 'accept-language' &&\n        k.toLowerCase() !== 'accept-encoding' &&\n        k.toLowerCase() !== 'connection' &&\n        k.toLowerCase() !== 'upgrade-insecure-requests');\n    if (method === 'GET' && !hasCustomHeader && !body) {\n        console.log('ğŸ“¤ Direct navigation for GET request');\n        try {\n            await chrome.tabs.update({ url });\n            return;\n        }\n        catch (error) {\n            console.error('Failed to navigate:', error);\n        }\n    }\n    // å…¶ä½™æƒ…å†µï¼šæ„é€ ä¸´æ—¶æ ‡ç­¾é¡µ + è¡¨å•æäº¤\n    console.log('ğŸ“¤ Creating form submission for complex request');\n    const html = `\n    <html>\n    <head>\n      <title>HackBar Request</title>\n    </head>\n    <body>\n      <form id=\"hackbar-form\" method=\"${method}\" action=\"${url}\">\n        ${Object.entries(headers)\n        .map(([k, v]) => `<input type=\"hidden\" name=\"header_${k}\" value=\"${String(v).replace(/\"/g, '&quot;')}\">`)\n        .join('')}\n        ${body ? `<input type=\"hidden\" name=\"body\" value=\"${String(body).replace(/\"/g, '&quot;')}\">` : ''}\n      </form>\n      <script>\n        console.log('ğŸš€ Submitting HackBar form...');\n        document.getElementById('hackbar-form').submit();\n      </script>\n    </body>\n    </html>`;\n    const blob = new Blob([html], { type: 'text/html' });\n    const blobUrl = URL.createObjectURL(blob);\n    try {\n        const tab = await chrome.tabs.create({ url: blobUrl });\n        console.log('âœ… HackBar form created in tab:', tab.id);\n        // 2ç§’åå…³é—­ä¸´æ—¶æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰\n        setTimeout(() => {\n            chrome.tabs.remove(tab.id).catch(() => {\n                console.log('Tab already closed or not found');\n            });\n        }, 2000);\n    }\n    catch (error) {\n        console.error('Failed to create HackBar form:', error);\n    }\n}\n// ç›‘å¬æ¥è‡ªdevtoolsçš„æ¶ˆæ¯\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n    switch (message.type) {\n        case 'TOGGLE_INTERCEPT':\n            isIntercepting = message.data.intercepting;\n            console.log('Intercepting toggled:', isIntercepting);\n            break;\n        case 'CLEAR_REQUESTS':\n            // æ¸…é™¤æ‰€æœ‰è¶…æ—¶å¤„ç†\n            pendingTimeouts.forEach((timeoutId) => {\n                clearTimeout(timeoutId);\n            });\n            pendingTimeouts.clear();\n            interceptedRequests = [];\n            break;\n        case 'GET_REQUESTS':\n            sendResponse({ requests: interceptedRequests });\n            break;\n        case 'SEND_REQUEST':\n            // HackBarè¯·æ±‚å¤„ç†\n            handleHackBarRequest(message.data);\n            break;\n        case 'REQUEST_CAPTURED':\n            // å¤„ç†æ¥è‡ªcontent scriptçš„è¯·æ±‚\n            if (message.data) {\n                const request = message.data;\n                request.tabId = sender.tab?.id || null;\n                // ç®€åŒ–å»é‡é€»è¾‘ï¼Œåªä½¿ç”¨webRequest\n                const existingIndex = interceptedRequests.findIndex(req => req.url === request.url &&\n                    req.method === request.method &&\n                    Math.abs(req.timestamp - request.timestamp) < 2000 // 2ç§’å†…çš„è¯·æ±‚è®¤ä¸ºæ˜¯é‡å¤çš„\n                );\n                if (existingIndex === -1) {\n                    interceptedRequests.unshift(request);\n                    console.log('âœ… New request captured:', {\n                        id: request.id,\n                        url: request.url,\n                        method: request.method,\n                        source: 'webRequest'\n                    });\n                    // é€šçŸ¥æ‰€æœ‰devtoolsé¢æ¿\n                    chrome.runtime.sendMessage({\n                        type: 'REQUEST_CAPTURED',\n                        data: request\n                    }).catch(() => {\n                        // å¿½ç•¥æ— æ³•å‘é€æ¶ˆæ¯çš„é”™è¯¯\n                    });\n                }\n                else {\n                    console.log('ğŸ”„ Duplicate request ignored:', {\n                        url: request.url,\n                        method: request.method,\n                        existingId: interceptedRequests[existingIndex].id,\n                        newId: request.id\n                    });\n                }\n            }\n            break;\n        case 'RESPONSE_CAPTURED':\n            // å¤„ç†æ¥è‡ªcontent scriptçš„å“åº”\n            if (message.data) {\n                const responseData = message.data;\n                console.log('Response captured from content script:', responseData);\n                // æŸ¥æ‰¾å¯¹åº”çš„è¯·æ±‚å¹¶æ›´æ–° - æ”¹è¿›åŒ¹é…é€»è¾‘\n                let requestIndex = interceptedRequests.findIndex(req => req.url === responseData.url && req.method === responseData.method);\n                // å¦‚æœç²¾ç¡®åŒ¹é…å¤±è´¥ï¼Œå°è¯•URLåŒ¹é…\n                if (requestIndex === -1) {\n                    requestIndex = interceptedRequests.findIndex(req => req.url === responseData.url);\n                }\n                if (requestIndex !== -1) {\n                    const request = interceptedRequests[requestIndex];\n                    // æ¸…é™¤è¶…æ—¶å¤„ç†\n                    const timeoutId = pendingTimeouts.get(request.id);\n                    if (timeoutId) {\n                        clearTimeout(timeoutId);\n                        pendingTimeouts.delete(request.id);\n                    }\n                    // åªæœ‰å½“çŠ¶æ€æ›´å¥½æ—¶æ‰æ›´æ–°ï¼ˆé¿å…ä»200é™çº§åˆ°pendingï¼‰\n                    if (!request.status || request.status < responseData.status || responseData.status < 400) {\n                        request.status = responseData.status;\n                        request.responseHeaders = responseData.headers;\n                        request.responseBody = responseData.body;\n                        request.responseTime = Date.now() - request.timestamp;\n                        console.log('âœ… Response processed and updated:', {\n                            url: responseData.url,\n                            status: responseData.status,\n                            responseTime: request.responseTime,\n                            previousStatus: request.status\n                        });\n                        // é€šçŸ¥devtoolsé¢æ¿æ›´æ–°\n                        chrome.runtime.sendMessage({\n                            type: 'REQUEST_UPDATED',\n                            data: request\n                        }).catch(() => {\n                            // å¿½ç•¥æ— æ³•å‘é€æ¶ˆæ¯çš„é”™è¯¯\n                        });\n                    }\n                    else {\n                        console.log('ğŸ”„ Response update skipped (better status already exists):', {\n                            url: responseData.url,\n                            currentStatus: request.status,\n                            newStatus: responseData.status\n                        });\n                    }\n                }\n                else {\n                    console.warn('âŒ Could not find matching request for response:', {\n                        url: responseData.url,\n                        method: responseData.method,\n                        availableRequests: interceptedRequests.map(req => ({\n                            url: req.url,\n                            method: req.method,\n                            id: req.id,\n                            status: req.status\n                        }))\n                    });\n                }\n            }\n            break;\n    }\n});\n// æ‹¦æˆªHTTPè¯·æ±‚ (Manifest V3å…¼å®¹)\nconsole.log('ğŸš€ Setting up webRequest listeners, isIntercepting:', isIntercepting);\nconsole.log('ğŸš€ Background script is running!');\nchrome.webRequest.onBeforeRequest.addListener((details) => {\n    console.log('ğŸ” WebRequest triggered:', {\n        url: details.url,\n        method: details.method,\n        isIntercepting,\n        requestId: details.requestId,\n        tabId: details.tabId,\n        type: details.type\n    });\n    if (!isIntercepting) {\n        console.log('Intercepting is disabled, skipping request');\n        return { cancel: false }; // æ˜ç¡®å…è®¸è¯·æ±‚ç»§ç»­\n    }\n    // è·³è¿‡ä¸€äº›ç‰¹æ®Šè¯·æ±‚ï¼Œé¿å…CORBé—®é¢˜\n    if (details.url.startsWith('chrome-extension://') ||\n        details.url.startsWith('moz-extension://') ||\n        details.url.startsWith('edge-extension://') ||\n        details.url.includes('devtools://') ||\n        details.url.includes('ztbox') || // è·³è¿‡ç™¾åº¦çš„ztboxè¯·æ±‚ï¼Œé¿å…CORBé—®é¢˜\n        details.url.includes('baidu.com/ztbox')) {\n        console.log('Skipping special request:', details.url);\n        return { cancel: false }; // æ˜ç¡®å…è®¸è¯·æ±‚ç»§ç»­\n    }\n    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„è¯·æ±‚ï¼ˆåŸºäºURLå’Œæ–¹æ³•ï¼Œå¿½ç•¥æ—¶é—´æˆ³ï¼‰\n    console.log('ğŸ” Checking for duplicates:', {\n        url: details.url,\n        method: details.method,\n        totalRequests: interceptedRequests.length\n    });\n    // åˆ›å»ºæ–°è¯·æ±‚\n    const request = {\n        id: `${details.requestId}-${Date.now()}`,\n        url: details.url,\n        method: details.method,\n        headers: {}, // å°†åœ¨onBeforeSendHeadersä¸­å¡«å……\n        body: extractRequestBody(details.requestBody),\n        timestamp: Date.now(),\n        tabId: details.tabId || null\n    };\n    // ä½¿ç”¨å»é‡å‡½æ•°å¤„ç†è¯·æ±‚\n    removeDuplicates(request);\n    console.log('âœ… Request processed via webRequest:', {\n        id: request.id,\n        url: request.url,\n        method: request.method,\n        timestamp: request.timestamp,\n        body: request.body,\n        bodyLength: request.body ? request.body.length : 0,\n        totalRequests: interceptedRequests.length\n    });\n    // ä¸ºæ‰€æœ‰è¯·æ±‚è®¾ç½®è¶…æ—¶å¤„ç†\n    const latestRequest = interceptedRequests[0]; // è·å–æœ€æ–°æ·»åŠ çš„è¯·æ±‚\n    const timeoutId = setTimeout(() => {\n        const requestIndex = interceptedRequests.findIndex(req => req.id === latestRequest.id);\n        if (requestIndex !== -1 && !interceptedRequests[requestIndex].status) {\n            console.warn('â° Request timeout, marking as failed:', {\n                id: latestRequest.id,\n                url: latestRequest.url,\n                method: latestRequest.method\n            });\n            interceptedRequests[requestIndex].status = 408; // Request Timeout\n            interceptedRequests[requestIndex].responseTime = PENDING_TIMEOUT;\n            // é€šçŸ¥devtoolsé¢æ¿æ›´æ–°\n            chrome.runtime.sendMessage({\n                type: 'REQUEST_UPDATED',\n                data: interceptedRequests[requestIndex]\n            }).catch(() => { });\n        }\n        pendingTimeouts.delete(latestRequest.id);\n    }, PENDING_TIMEOUT);\n    pendingTimeouts.set(latestRequest.id, timeoutId);\n    // é€šçŸ¥devtoolsé¢æ¿ - ç›´æ¥å‘é€æ›´æ–°æ¶ˆæ¯\n    chrome.runtime.sendMessage({\n        type: 'REQUEST_UPDATED',\n        data: latestRequest\n    }).catch((error) => {\n        console.log('Failed to send message to devtools:', error);\n    });\n    // æ˜ç¡®å…è®¸è¯·æ±‚ç»§ç»­\n    return { cancel: false };\n}, { urls: ['<all_urls>'] }, ['requestBody']);\n// æ‹¦æˆªHTTPè¯·æ±‚å¤´\nchrome.webRequest.onBeforeSendHeaders.addListener((details) => {\n    if (!isIntercepting)\n        return;\n    // è·³è¿‡ä¸€äº›ç‰¹æ®Šè¯·æ±‚ï¼Œé¿å…CORBé—®é¢˜\n    if (details.url.startsWith('chrome-extension://') ||\n        details.url.startsWith('moz-extension://') ||\n        details.url.startsWith('edge-extension://') ||\n        details.url.includes('devtools://') ||\n        details.url.includes('ztbox') || // è·³è¿‡ç™¾åº¦çš„ztboxè¯·æ±‚ï¼Œé¿å…CORBé—®é¢˜\n        details.url.includes('baidu.com/ztbox')) {\n        return;\n    }\n    // æŸ¥æ‰¾å¯¹åº”çš„è¯·æ±‚å¹¶æ›´æ–°headers\n    const requestIndex = interceptedRequests.findIndex(req => req.id.includes(details.requestId));\n    if (requestIndex !== -1) {\n        const headers = {};\n        // å¤„ç†è¯·æ±‚å¤´\n        if (details.requestHeaders) {\n            details.requestHeaders.forEach(header => {\n                if (header.name && header.value) {\n                    headers[header.name] = header.value;\n                }\n            });\n        }\n        interceptedRequests[requestIndex].headers = headers;\n        console.log('ğŸ“‹ Request headers captured:', {\n            url: details.url,\n            method: details.method,\n            headersCount: Object.keys(headers).length,\n            headers: headers\n        });\n    }\n}, { urls: ['<all_urls>'] }, ['requestHeaders']);\n// æ‹¦æˆªHTTPå“åº”å¤´\nchrome.webRequest.onHeadersReceived.addListener((details) => {\n    if (!isIntercepting)\n        return;\n    // è·³è¿‡ä¸€äº›ç‰¹æ®Šè¯·æ±‚ï¼Œé¿å…CORBé—®é¢˜\n    if (details.url.startsWith('chrome-extension://') ||\n        details.url.startsWith('moz-extension://') ||\n        details.url.startsWith('edge-extension://') ||\n        details.url.includes('devtools://') ||\n        details.url.includes('ztbox') || // è·³è¿‡ç™¾åº¦çš„ztboxè¯·æ±‚ï¼Œé¿å…CORBé—®é¢˜\n        details.url.includes('baidu.com/ztbox')) {\n        return;\n    }\n    // æ›´æ–°è¯·æ±‚çš„å“åº”å¤´ - æ”¹è¿›åŒ¹é…é€»è¾‘\n    let requestIndex = interceptedRequests.findIndex(req => req.id.includes(details.requestId));\n    // å¦‚æœç›´æ¥åŒ¹é…å¤±è´¥ï¼Œå°è¯•URLåŒ¹é…ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ\n    if (requestIndex === -1) {\n        requestIndex = interceptedRequests.findIndex(req => req.url === details.url && req.method === details.method);\n    }\n    if (requestIndex !== -1) {\n        const responseHeaders = {};\n        details.responseHeaders?.forEach(header => {\n            if (header.name && header.value) {\n                // ç¡®ä¿CORSå“åº”å¤´å€¼æœ‰æ•ˆ\n                try {\n                    // éªŒè¯headerå€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆå­—ç¬¦\n                    if (header.value && typeof header.value === 'string' && header.value.trim()) {\n                        responseHeaders[header.name] = header.value;\n                    }\n                }\n                catch (error) {\n                    console.warn('Invalid header value:', header.name, header.value);\n                }\n            }\n        });\n        interceptedRequests[requestIndex].responseHeaders = responseHeaders;\n        console.log('Response headers captured:', responseHeaders);\n    }\n}, { urls: ['<all_urls>'] }, ['responseHeaders']);\n// æ‹¦æˆªHTTPå“åº”å®Œæˆ\nchrome.webRequest.onCompleted.addListener((details) => {\n    if (!isIntercepting)\n        return;\n    // è·³è¿‡ä¸€äº›ç‰¹æ®Šè¯·æ±‚ï¼Œé¿å…CORBé—®é¢˜\n    if (details.url.startsWith('chrome-extension://') ||\n        details.url.startsWith('moz-extension://') ||\n        details.url.startsWith('edge-extension://') ||\n        details.url.includes('devtools://') ||\n        details.url.includes('ztbox') || // è·³è¿‡ç™¾åº¦çš„ztboxè¯·æ±‚ï¼Œé¿å…CORBé—®é¢˜\n        details.url.includes('baidu.com/ztbox')) {\n        return;\n    }\n    // æ›´æ–°è¯·æ±‚çŠ¶æ€ - æ”¹è¿›åŒ¹é…é€»è¾‘\n    let requestIndex = interceptedRequests.findIndex(req => req.id.includes(details.requestId));\n    // å¦‚æœç›´æ¥åŒ¹é…å¤±è´¥ï¼Œå°è¯•URLåŒ¹é…ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ\n    if (requestIndex === -1) {\n        requestIndex = interceptedRequests.findIndex(req => req.url === details.url && req.method === details.method);\n    }\n    console.log('Looking for request completion:', {\n        requestId: details.requestId,\n        url: details.url,\n        statusCode: details.statusCode,\n        totalRequests: interceptedRequests.length,\n        foundIndex: requestIndex\n    });\n    if (requestIndex !== -1) {\n        const request = interceptedRequests[requestIndex];\n        // æ¸…é™¤è¶…æ—¶å¤„ç†\n        const timeoutId = pendingTimeouts.get(request.id);\n        if (timeoutId) {\n            clearTimeout(timeoutId);\n            pendingTimeouts.delete(request.id);\n        }\n        // åªæœ‰å½“çŠ¶æ€æ›´å¥½æ—¶æ‰æ›´æ–°ï¼ˆé¿å…ä»200é™çº§åˆ°pendingï¼‰\n        if (!request.status || request.status < details.statusCode || details.statusCode < 400) {\n            request.status = details.statusCode;\n            // ä¿®å¤æ—¶é—´æˆ³è®¡ç®—\n            const responseTime = details.timeStamp ?\n                Math.round(details.timeStamp - request.timestamp) :\n                Date.now() - request.timestamp;\n            request.responseTime = responseTime;\n            console.log('âœ… Request completed and updated:', {\n                url: details.url,\n                status: details.statusCode,\n                responseTime: responseTime,\n                requestId: details.requestId,\n                previousStatus: request.status,\n                note: 'Response body not available via webRequest API'\n            });\n        }\n        else {\n            console.log('ğŸ”„ Request completion update skipped (better status already exists):', {\n                url: details.url,\n                currentStatus: request.status,\n                newStatus: details.statusCode,\n                requestId: details.requestId\n            });\n        }\n        // é€šçŸ¥devtoolsé¢æ¿æ›´æ–°\n        chrome.runtime.sendMessage({\n            type: 'REQUEST_UPDATED',\n            data: request\n        }).catch((error) => {\n            console.warn('Failed to send request update:', error);\n        });\n    }\n    else {\n        console.warn('âŒ Could not find matching request for completion:', {\n            requestId: details.requestId,\n            url: details.url,\n            availableIds: interceptedRequests.map(req => req.id)\n        });\n    }\n}, { urls: ['<all_urls>'] });\n// å¼€å‘è€…å·¥å…·è¿æ¥æ—¶å‘é€ç°æœ‰è¯·æ±‚\nchrome.runtime.onConnect.addListener((port) => {\n    if (port.name === 'devtools') {\n        try {\n            port.postMessage({\n                type: 'REQUESTS_LOADED',\n                data: { requests: interceptedRequests }\n            });\n        }\n        catch (error) {\n            console.warn('Failed to send requests to devtools:', error);\n        }\n    }\n});\n// æ·»åŠ é”™è¯¯å¤„ç†\nchrome.runtime.onStartup.addListener(() => {\n    console.log('HackDuck extension started');\n});\nchrome.runtime.onInstalled.addListener(() => {\n    console.log('HackDuck extension installed');\n});\nexport {};\n"],"names":["console","log","interceptedRequests","isIntercepting","extractRequestBody","requestBody","formData","params","URLSearchParams","key","values","Object","entries","Array","isArray","forEach","value","append","toString","raw","length","rawData","bytes","TextDecoder","decode","error","warn","pendingTimeouts","Map","chrome","runtime","onMessage","addListener","message","sender","sendResponse","type","data","intercepting","timeoutId","clearTimeout","clear","requests","async","url","method","headers","body","hasCustomHeader","keys","some","k","toLowerCase","tabs","update","html","map","v","String","replace","join","blob","Blob","blobUrl","URL","createObjectURL","tab","create","id","setTimeout","remove","catch","handleHackBarRequest","request","tabId","existingIndex","findIndex","req","Math","abs","timestamp","unshift","source","sendMessage","existingId","newId","responseData","requestIndex","get","delete","status","responseHeaders","responseBody","responseTime","Date","now","previousStatus","currentStatus","newStatus","availableRequests","webRequest","onBeforeRequest","details","requestId","cancel","startsWith","includes","totalRequests","newRequest","removedRequest","splice","oldIndex","removedId","removeDuplicates","bodyLength","latestRequest","set","urls","onBeforeSendHeaders","requestHeaders","header","name","headersCount","onHeadersReceived","trim","onCompleted","statusCode","foundIndex","timeStamp","round","note","availableIds","onConnect","port","postMessage","onStartup","onInstalled"],"sourceRoot":""}